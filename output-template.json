{
 "Resources": {
  "SuperCoolAPI": {
   "Type": "AWS::AppSync::GraphQLApi",
   "Properties": {
    "Name": "SomeApi",
    "Tags": [
     {
      "Key": "key1",
      "Value": "value1"
     },
     {
      "Key": "key2",
      "Value": "value2"
     }
    ],
    "XrayEnabled": true,
    "AuthenticationType": "AWS_IAM",
    "LogConfig": {
     "FieldLogLevel": "ALL",
     "CloudWatchLogsRoleArn": {
      "Fn::GetAtt": [
       "SuperCoolAPICloudWatchRole",
       "Arn"
      ]
     }
    }
   }
  },
  "SuperCoolAPISchema": {
   "Type": "AWS::AppSync::GraphQLSchema",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "SuperCoolAPI",
      "ApiId"
     ]
    },
    "Definition": "type Mutation {\n  addTodo(id: ID!, name: String, description: String, priority: Int): Todo\n}\n"
   }
  },
  "SuperCoolAPICloudWatchRole": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Version": "2012-10-17",
     "Statement": [
      {
       "Action": [
        "sts:AssumeRole"
       ],
       "Effect": "Allow",
       "Principal": {
        "Service": [
         "appsync.amazonaws.com"
        ]
       }
      }
     ]
    },
    "ManagedPolicyArns": [
     {
      "Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/service-role/AWSAppSyncPushToCloudWatchLogs"
     }
    ]
   }
  },
  "SuperCoolAPILambdaMyDataSource": {
   "Type": "AWS::AppSync::DataSource",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "SuperCoolAPI",
      "ApiId"
     ]
    },
    "Description": "lambda datasources are nice",
    "Name": "PradsLambdaDataSource",
    "Type": "AWS_LAMBDA",
    "ServiceRoleArn": "some-role-arn",
    "LambdaConfig": {
     "LambdaFunctionArn": "my-lambda-arn"
    }
   }
  },
  "SuperCoolAPIMyFunction": {
   "Type": "AWS::AppSync::FunctionConfiguration",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "SuperCoolAPI",
      "ApiId"
     ]
    },
    "Code": "this is my epic code",
    "DataSourceName": {
     "Fn::GetAtt": [
      "SuperCoolAPILambdaMyDataSource",
      "Name"
     ]
    },
    "MaxBatchSize": 10,
    "Name": "MyFunction",
    "Runtime": {
     "Name": "some-runtime",
     "RuntimeVersion": "1.2.3"
    }
   }
  },
  "SuperCoolAPIMutationmyResolver": {
   "Type": "AWS::AppSync::Resolver",
   "DependsOn": [
    "SuperCoolAPISchema"
   ],
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "SuperCoolAPI",
      "ApiId"
     ]
    },
    "CachingConfig": {
     "Ttl": 20,
     "CachingKeys": [
      "key1",
      "key2"
     ]
    },
    "Code": "\nexport function request(ctx) {\n    return {};\n}\n\nexport function response(ctx) {\n    return ctx.prev.result;\n}\n",
    "FieldName": "my_field",
    "Kind": "PIPELINE",
    "PipelineConfig": {
     "Functions": [
      {
       "Fn::GetAtt": [
        "SuperCoolAPIMyFunction",
        "FunctionId"
       ]
      }
     ]
    },
    "Runtime": {
     "Name": "some-runtime",
     "RuntimeVersion": "1.2.3"
    },
    "TypeName": "Mutation"
   }
  },
  "SuperCoolAPINoneDataSource": {
   "Type": "AWS::AppSync::DataSource",
   "Properties": {
    "ApiId": {
     "Fn::GetAtt": [
      "SuperCoolAPI",
      "ApiId"
     ]
    },
    "Name": "SuperCoolAPINoneDataSource",
    "Type": "NONE"
   }
  }
 }
}