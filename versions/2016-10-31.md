# AWS Serverless Application Definition Specification

#### Version 2016-10-31

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC 2119](http://www.ietf.org/rfc/rfc2119.txt).

The AWS Serverless Application Definition specification is licensed under [The Apache License, Version 2.0](http://www.apache.org/licenses/LICENSE-2.0.html).

## Introduction

AWS Serverless Application Definition is a specification used to define serverless applications on AWS. Serverless applications are applications composed of functions triggered by events. A typical serverless application consists of one or more AWS Lambda Functions triggered by events such as object uploads to S3, SNS notifications, and API actions. Those functions can stand alone or leverage other resources such as DynamoDB tables or S3 buckets. The most basic serverless application is simply a function.

The AWS Serverless Application Definition Specification is based on [AWS CloudFormation](https://aws.amazon.com/cloudformation/). A serverless application is defined in an [AWS CloudFormation template](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/gettingstarted.templatebasics.html) and deployed as an [AWS CloudFormation stack](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html). A AWS Serverless Application Definition template is an AWS CloudFormation template.

The AWS Serverless Application Definition Specification defines a set of objects which can be included in an AWS CloudFormation template to easily describe common components of serverless applications.


## Specification

### Format

The files describing a serverless application in accordance with the AWS Serverless Application Definition Specification are [JSON](http://www.json.org/) or [YAML](http://yaml.org/spec/1.1/) formatted text files. These files are [AWS CloudFormation templates](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-guide.html). The AWS Serverless Application Definition Specification introduces several new resources and property types which can be embedded into the [Resources](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/resources-section-structure.html) section of the template. The templates may include all other template sections and use [AWS CloudFormation Intrinsic Functions](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference.html) to access properties available only at runtime. In order to include objects defined by the AWS Serverless Application Definition Specification within an AWS CloudFormation template, the template must include a `Transform` section in the document root with a value of `AWS::Serverless-2016-10-31`.

#### AWS Serverless Application Definition Template Example

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Transform: 'AWS::Serverless-2016-10-31'
Resources:
  MyFunction:
    Type: 'AWS::Serverless::Function'
    Properties:
      Handler: index.handler
      Runtime: nodejs4.3
      CodeUri: 's3://my-bucket/function.zip'
```

All property names in the specification are **case sensitive**.

### AWS Serverless Application Definition Resource Types

#### AWS::Serverless::Function

The `AWS::Serverless::Function` resource creates an AWS Lambda function, IAM execution role, and event source mappings which trigger the function.

##### Properties

Property Name | Type | Description
---|:---:|---
Handler | `string` | **Required.** Function within your code called to begin execution.
Runtime | `string` | **Required.** The runtime environment.
CodeUri | `string` | **Required.** S3 Uri to the function code. The S3 object this Uri references MUST be an [AWS Lambda deployment package](http://docs.aws.amazon.com/lambda/latest/dg/deployment-package-v2.html).
Description | `string` | Description of the function.
MemorySize | `integer` | Size of the memory allocated per invocation of the function in Megabytes. Defaults to 128.
Timeout | `integer` | Maximum time the function can run before it is killed in seconds. Defaults to 3.
Role | `string` | ARN of an IAM role to use as this function's execution role. If ommitted, a default role will be created for this function.
Policies | `string` <span>&#124;</span> [`string`] <span>&#124;</span> [IAM Policy Document Object](http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies.html) <span>&#124;</span> [[IAM Policy Document Object](http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies.html)]| Names of AWS managed IAM policies or IAM Policy documents this function needs which should be appended to the default role for this function. If the Role property is set, this property has no meaning.
Environment | [Function Environment Object](#function-environment-object) | Configuration for the runtime environment.
VpcConfig | [VPC Config Object](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-lambda-function-vpcconfig.html) | Configuration to enable this function to access private resources within your VPC.
Events | Map of `string` to [Event Source Object](#event-source-object) | A map (string to [Event Source Object](#event-source-object)) that defines the events which trigger this function. Keys are limited to alphanumeric characters.

##### Return Values

###### Ref

When the logical ID of this resource is provided to the [Ref intrinsic function](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html), Ref returns the resource name of the underlying Lambda Function.

###### Fn::GetAtt

[Fn::GetAtt](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-getatt.html) returns a value for a specified attribute of this type. This section lists the available attributes.

Attribute Name | Description
---|---
FunctionArn | The ARN of the Lambda Function.

###### AWS::Serverless::Function Example:

```yaml
Handler: index.js
Runtime: nodejs4.3
CodeUri: 's3://my-code-bucket/my-function.zip'
Description: Creates thumbnails of uploaded images
MemorySize: 1024
Timeout: 15
Policies: AmazonS3FullAccess
Environment:
  Variables:
    TABLE_NAME: my-table
Events:
  PhotoUpload:
    Type: S3
    Properties:
      Id: my-photo-bucket
```

#### AWS::Serverless::Api

The `AWS::Serverless::Api` resource creates a collection Amazon API Gateway resources and methods that can be invoked through HTTPS endpoints.

An `AWS::Serverless::Api` resource need not be explicitly added to a AWS Serverless Application Definition template. A resource of this type will be implicitly created from the union of [Api](#api) events defined on `AWS::Serverless::Function` resources defined in the template which do not refer to an `AWS::Serverless::Api` resource. An `AWS::Serverless::Api` resource should be used to define and document the Api using Swagger, which provides more ability to configure the underlying Amazon API Gateway resources.

##### Properties

Property Name | Type | Description
---|:---:|---
StageName | `string` | **Required** The name of the stage, which API Gateway uses as the first path segment in the invoke Uniform Resource Identifier (URI).
DefinitionUri | `string` | **Required** S3 Uri to the Swagger document describing the Api.
CacheClusterEnabled | `boolean` | Indicates whether cache clustering is enabled for the stage.
CacheClusterSize | `integer` | The stage's cache cluster size.
Variables | Map of `string` to `string` | A map (string to string map) that defines the stage variables, where the variable name is the key and the variable value is the value. Variable names are limited to alphanumeric characters. Values must match the following regular expression: [A-Za-z0-9-._~:/?#&amp;=,]+.

##### Return Values

###### Ref

When the logical ID of this resource is provided to the [Ref intrinsic function](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html), Ref returns the resource name of the underlying API Gateway RestApi.

##### AWS::Serverless::Api Example:

```yaml
StageName: prod
DefinitionUri: swagger.yml
```

#### AWS::Serverless::SimpleTable

The `AWS::Serverless::SimpleTable` resource creates a DynamoDB table with a single attribute primary key. It is useful when data only needs to be accessed via a primary key. To use the more advanced functionality of DynamoDB, use an [AWS::DynamoDB::Table](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html) resource instead.

##### Properties

Property Name | Type | Description
---|:---:|---
PrimaryKey | [Primary Key Object](#primary-key-object) | Attribute name and type to be used as the table's primary key. **This cannot be modifed without replacing the resource.** Defaults to `String` attribute named id.
ProvisionedThroughput | [Provisioned Throughput Object](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-dynamodb-provisionedthroughput.html) | Read and write throughput provisioning information. Defaults to 5 read and 5 write capacity units per second.

##### Return Values

###### Ref

When the logical ID of this resource is provided to the [Ref intrinsic function](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html), Ref returns the resource name of the underlying DynamoDB Table.

##### AWS::Serverless::SimpleTable Example:

```yaml
PrimaryKey:
  Name: id
  Type: String
ProvisionedThroughput:
  ReadCapacityUnits: 5
  WriteCapacityUnits: 5
```

### Event Source Types

#### S3

The object describing an event source with type `S3`

##### Properties

Property Name | Type | Description
---|:---:|---
Bucket | `string` | **Required.** S3 bucket name.
Events | `string` <span>&#124;</span> [`string`] | Valid values are `Create` and `Remove`
Filter | [Amazon S3 Notification Filter](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-s3-bucket-notificationconfiguration-config-filter.html) | Rules to filter events on.

##### S3 Event Source Object Example:

```yaml
Bucket: my-photo-bucket
```

#### SNS

The object describing an event source with type `SNS`

##### Properties

Property Name | Type | Description
---|:---:|---
Topic | `string` | **Required.** Topic ARN.

##### SNS Event Source Object Example:

```yaml
Topic: arn:aws:sns:us-east-1:123456789012:my_topic
```

#### Kinesis

The object describing an event source with type `Kinesis`.

##### Properties

Property Name | Type | Description
---|:---:|---
Stream | `string` | **Required.** ARN of the Kinesis stream.
BatchSize | `integer` | Maximum number of stream records to process per function invocation.
StartingPosition | `string` | One of `TRIM_HORIZON` or `LATEST`

##### Kinesis Event Source Object Example:

```yaml
Id: arn:aws:kinesis:us-east-1:123456789012:stream/my-stream
BatchSize: 10
```

#### DynamoDB

The object describing an event source with type `DynamoDB`.

##### Properties

Property Name | Type | Description
---|:---:|---
Stream | `string` | **Required.** ARN of the DynamoDB Stream.
BatchSize | `integer` | Maximum number of stream records to process per function invocation.
StartingPosition | `string` | One of `TRIM_HORIZON` or `LATEST`

##### DynamoDB Event Source Object Example:

```yaml
Stream: arn:aws:dynamodb:us-east-1:123456789012:table/TestTable/stream/2016-08-11T21:21:33.291
BatchSize: 10
```

#### Api

The object describing an event source with type `Api`.

If an [AWS::Serverless::Api](#aws-serverless-api) resource is defined, the path and method values MUST correspond to an operation in the Swagger definition of the Api. If no [AWS::Serverless::Api](#aws-serverless-api) is defined, the function input and output will be a represenation of the HTTP request and HTTP response.

##### Properties

Property Name | Type | Description
---|:---:|---
Path | `string` | **Required.** Uri path this function is invoked for. MUST start with `/`.
Method | `string` | **Required.** HTTP method this function is invoked for.
RestApiId | `string` | Identifier of a RestApi resource which MUST contain an operation with the given path and method. Typically this will be set to [reference](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html) an `AWS::Serverless::Api` resource defined in this template. If not defined, a default `AWS::Serverless::Api` resource will be created using a generated Swagger document contains a union of all paths and methods defined by `Api` events defined in this template that do not specify a RestApiId.
RestApiStage | `string` | Stage name of the RestApi resource which triggers this event. MUST be specified if `RestApiId` property is specified. Typically this will be set to the stage name [attribute](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-getatt.html) of an `AWS::Serverless::Api` resource defined in this template.
CustomIntegration | [Custom Integration Object](#custom-integration-object) | Custom API Gateway integration. If this event references a RestApiId, this attribute has not effect. If omitted, the generated RestApi will use SimpleProxy.


##### Api Event Source Object Example:

```yaml
Path: /photos
Method: post
```

#### Schedule

The object describing an event source with type `Schedule`.

##### Properties

Property Name | Type | Description
---|:---:|---
Schedule | `string` | **Required.** Schedule expression, which MUST follow the [schedule expression syntax rules](http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html).
Input | `string` | JSON formatted string to pass to the function as the event body.

##### Scheduled Event Source Object Example:

```yaml
Schedule: rate(5 minutes)
```

#### CloudWatchEvent:

The object describing an event source with type `CloudWatchEvent`.

##### Properties

Property Name | Type | Description
---|:---:|---
Pattern | [Event Pattern Object](http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/CloudWatchEventsandEventPatterns.html) | **Required.** Pattern describing which CloudWatch Events trigger the function. Only matching events will trigger the function.
Input | `string` | JSON formatted string to pass to the function as the event body. This value overrides the matched event.
InputPath | `string` | JSONPath describing the part of the event to pass to the function.

##### CloudWatchEvent Event Source Object Example:

```yaml
Pattern:
  detail:
    state:
      - terminated
```

#### IoTRule:

The object describing an event source with type `IoTRule`.

##### Properties

Property Name | Type | Description
---|:---:|---
Sql | `string` | **Required.** The SQL statement that queries the topic. For more information, see [Rules for AWS IoT](http://docs.aws.amazon.com/iot/latest/developerguide/iot-rules.html#aws-iot-sql-reference) in the AWS IoT Developer Guide.
AwsIotSqlVersion | `string` | The version of the SQL rules engine to use when evaluating the rule.

##### IoTRule Event Source Object Example:

```yaml
Sql: "SELECT * FROM 'iot/test'"
```

#### AlexaSkill:

The object describing an event source with type `AlexaSkill`.
Specifying `AlexaSkill` event will create a resource policy that allows the Amazon Alexa service to call your Lambda function. To configure the Alexa service to work with your Lambda function, go to the Alexa Developer portal.

### AWS Serverless Application Definition Property Types

#### Environment Object

The object describing the environment properties of a function.

##### Properties

Property Name | Type | Description
---|:---:|---
Variables | Map of `string` to `string` | A map (string to string map) that defines the environment variables, where the variable name is the key and the variable value is the value. Variable names are limited to alphanumeric characters and the first character must be letter. Values are limited to alphanumeric characters and the following special characters `_(){}[]$*+-\/"#',;.@!?`. ***LINK TO LIMITS ONCE THE DOCS ARE READY***.

##### Environment Object Example:

```yaml
Variables:
  TABLE_NAME: my-table
  STAGE: prod
```

#### Event Source Object

The object describing the source of events which trigger the function.

##### Properties

Property Name | Type | Description
---|:---:|---
Type | `string` | **Required.** Event type. Event source types include '[S3](#s3), '[Api](#api)', '[SNS](#sns)', '[Kinesis](#kinesis)', '[DynamoDB](#dynamodb)'. See [Event Source Types](#event-source-types) for all types.
Properties | * | **Required.** Object describing properties of this event mapping. Must conform to the defined `Type`. See [Event Source Types](#event-source-types) for all types.

##### Event Source Object Example:

```yaml
Type: S3
Properties:
  Id: my-photo-bucket
```

```yaml
Type: AlexaSkill
```

#### Primary Key Object

The object describing the properties of a primary key.

##### Properties

Property Name | Type | Description
---|:---:|---
Name | `string` | Attribute name of the primary key. Defaults to `id`.
Type | `string` | Attribute type of the primary key. MUST be one of `String`, `Number`, or `Binary`.

##### Primary Key Object Example:

```yaml
Name: id
Type: String
```

#### Custom Integration Object

The object describing the properties of a custom API Gateway integration with a Lambda Function.

##### Properties

Property Name | Type | Description
---|:---:|---
RequestTemplates | [RequestTemplates Object](http://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions.html#api-gateway-swagger-extensions-integration-requestTemplates) | Mapping templates for a request payload of specified MIME types.
CacheNamespace | `string` | An API-specific tag group of related cached parameters.
CacheKeyParameters | [`string`] | A list of request parameters whose values are to be cached.
Responses | [Responses Object](http://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions.html#api-gateway-swagger-extensions-integration-responses) | Defines the method's responses and specifies desired parameter mappings or payload mappings from integration responses to method responses.

##### Custom Integration Object Example:

```yaml
RequestTemplates:
  application/json: "#set ($root=$input.path('$')) { \"stage\": \"$root.name\", \"user-id\": \"$root.key\" }"
  application/xml: "#set ($root=$input.path('$')) <stage>$root.name</stage> "
CacheNamespace: cache namespace
CacheKeyParameters:
Responses:
  "2\\d{2}":
    statusCode: 200
    responseParameters:
      method.response.header.requestId: integration.response.header.cid
    responseTemplates:
      application/json: "#set ($root=$input.path('$')) { \"stage\": \"$root.name\", \"user-id\": \"$root.key\" }"
      application/xml: "#set ($root=$input.path('$')) <stage>$root.name</stage> "
  "302":
    statusCode: 302
    responseParameters:
      method.response.header.Location: integration.response.body.redirect.url
  default:
    statusCode: 400
    responseParameters:
      method.response.header.test-method-response-header: "'static value'"
```
