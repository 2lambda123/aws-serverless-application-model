Resources:

  FunctionWithSigningProfile:
    Type: AWS::Serverless::Function
    DeletionPolicy: Delete
    UpdateReplacePolicy: Retain
    Properties:
      CodeUri: s3://sam-demo-bucket/member_portal.zip
      Handler: index.gethtml
      Runtime: nodejs12.x
      CodeSigningConfigArn: !Ref MySignedFunctionCodeSigningConfig

  MySignedFunctionCodeSigningConfig:
    Type: AWS::Lambda::CodeSigningConfig
    DeletionPolicy: Delete
    UpdateReplacePolicy: Retain
    Properties:
      Description: "Code Signing for MySignedLambdaFunction"
      AllowedPublishers:
        SigningProfileVersionArns:
          - !GetAtt SigningProfile.ProfileVersionArn
      CodeSigningPolicies:
        UntrustedArtifactOnDeployment: "Enforce"

  SigningProfile:
    Type: AWS::Signer::SigningProfile
    DeletionPolicy: Delete
    UpdateReplacePolicy: Retain
    Properties:
      PlatformId: AWSLambda-SHA384-ECDSA